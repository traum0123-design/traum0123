{% extends 'base.html' %}
{% block content %}
<h1>회사 관리</h1>

<div class="flex-end">
  <a class="btn" href="{{ url_for('admin.audit') }}" aria-label="감사 로그 보기">감사 로그</a>
  <a class="btn" href="{{ url_for('admin.policy_history') }}" aria-label="정책 변경 이력">정책 이력</a>
  <a class="btn" href="{{ url_for('admin.closings') }}" aria-label="월별 마감 현황">마감 현황</a>
  </div>

<div class="card">
  <h2>신규 회사 추가</h2>
  <form method="post" action="{{ url_for('admin.company_new') }}" class="form" aria-label="신규 회사 추가">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    <label for="newCompanyName">회사명</label>
    <input id="newCompanyName" type="text" name="name" placeholder="예: ㈜아이템" required aria-required="true">
    <label for="newCompanySlug">슬러그</label>
    <input id="newCompanySlug" type="text" name="slug" placeholder="예: acme" required aria-required="true">
    <button type="submit" class="primary" aria-label="회사 추가">추가</button>
  </form>
  <p class="hint">생성 시 회사 전용 접속코드가 1회 표시됩니다.</p>
  </div>

<div class="card">
  <h2>등록된 회사</h2>
  <div class="table-wrap">
  <table class="table">
    <thead>
      <tr>
        <th>회사명</th>
        <th>슬러그</th>
        <th>생성일</th>
        <th>관리</th>
      </tr>
    </thead>
    <tbody>
      {% for c in companies %}
      <tr>
        <td>{{ c.name }}</td>
        <td>{{ c.slug }}</td>
        <td>{{ c.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
        <td>
          <a href="{{ url_for('admin.company_detail', company_id=c.id) }}">보기</a>
          ·
          <a href="{{ url_for('admin.company_impersonate', company_id=c.id) }}">포털</a>
          ·
          <form method="post" action="{{ url_for('admin.company_delete', company_id=c.id) }}" class="d-inline" style="display:inline" data-confirm="정말 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다.">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button type="submit" class="btn danger" style="padding:4px 8px;">삭제</button>
          </form>
        </td>
      </tr>
      {% else %}
      <tr><td colspan="4">등록된 회사가 없습니다.</td></tr>
      {% endfor %}
    </tbody>
  </table>
  </div>
</div>

<div class="card mt-12">
  <h2>세금 · 간이세액표</h2>
  <p class="muted">국세청 간이세액표(연도별)를 업로드하고 샘플 조회로 검증할 수 있습니다.</p>
  <div class="flex-end">
    <a class="btn" href="{{ url_for('admin.index') }}#withholding">간이세액표 관리 이동</a>
  </div>
  {% if wh_counts %}
  <ul class="mt-8">
    {% for info in wh_counts %}
      <li>{{ info.year }}년: {{ info.count }}건</li>
    {% endfor %}
  </ul>
  {% endif %}
</div>
{% endblock %}
